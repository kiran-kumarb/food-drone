<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Drone Food Delivery - Customer Portal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <!-- üß≠ Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="#">üöÅ DroneFood</a>
      <div class="d-flex ms-auto">
        <a href="admin.html" class="btn btn-outline-light">Admin Login</a>
      </div>
    </div>
  </nav>

  <!-- üõí Customer Section -->
  <div class="container mt-5">
    <h2 class="text-center text-primary mb-4">üçΩÔ∏è Place Your Order</h2>

    <div class="mb-3">
      <label class="form-label">Select Customer</label>
      <select id="customerID" class="form-select"></select>
    </div>

    <div class="mb-3">
      <label class="form-label">Select Restaurant</label>
      <select id="restaurantID" class="form-select" onchange="loadMenu()"></select>
    </div>

    <div class="mb-3">
      <label class="form-label">Available Menu</label>
      <div id="menuItems" class="border p-3 bg-white rounded"></div>
    </div>

    <button class="btn btn-success" onclick="placeOrder()">Place Order</button>
  </div>

  <script>
    async function loadCustomers() {
      const res = await fetch('/customers');
      const data = await res.json();
      document.getElementById('customerID').innerHTML = data.map(
        c => `<option value="${c.CustomerID}">${c.Name}</option>`
      ).join('');
    }

    async function loadRestaurants() {
      const res = await fetch('/restaurants');
      const data = await res.json();
      document.getElementById('restaurantID').innerHTML = data.map(
        r => `<option value="${r.RestaurantID}">${r.Name}</option>`
      ).join('');
    }

    async function loadMenu() {
      const restID = document.getElementById('restaurantID').value;
      const res = await fetch(`/menu/${restID}`);
      const data = await res.json();
      document.getElementById('menuItems').innerHTML = data.map(
        m => `
        <div class="form-check mb-1">
          <input class="form-check-input" type="checkbox" value="${m.ItemID}" id="item${m.ItemID}">
          <label class="form-check-label" for="item${m.ItemID}">
            ${m.Name} - ‚Çπ${m.Price}
          </label>
          <input type="number" id="qty${m.ItemID}" class="form-control form-control-sm mt-1" value="1" min="1" style="width:80px;">
        </div>`
      ).join('');
    }

    async function placeOrder() {
      const customerID = document.getElementById('customerID').value;
      const restaurantID = document.getElementById('restaurantID').value;
      const items = [...document.querySelectorAll('input[type=checkbox]:checked')].map(chk => ({
        itemID: chk.value,
        qty: document.getElementById('qty' + chk.value).value
      }));

      const res = await fetch('/placeOrder', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ customerID, restaurantID, items })
      });
      const result = await res.json();
      alert(result.message);
    }

    loadCustomers();
    loadRestaurants();
  </script>

</body>
</html>
